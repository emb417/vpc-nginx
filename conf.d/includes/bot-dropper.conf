# ----------------------------------------------------------------------
# Bot Dropper: silently drop common IoT/router exploit scans
# ----------------------------------------------------------------------

# Block obvious scanner user-agents
if ($http_user_agent ~* "(asusrouter|curl|wget|python-requests|libredtail-http|masscan|nmap|sqlmap|zgrab|go-http-client)") {
    return 444;
}

# Block common exploitation patterns in query strings
if ($args ~* "(php://input|allow_url_include|auto_prepend_file|invokefunction|call_user_func_array|pearcmd)") {
    return 444;
}

# ASUS / router / IoT exploit probes (path-based)
location ~* /(login\.cgi|Main_Login\.asp|appGet\.cgi|start_apply\.cgi|apply\.cgi|Advanced_.*\.asp) {
    return 444;
}

# Unified extension-based dropper for generic exploit probes
# We match these extensions anywhere in the URI to catch variants
location ~* \.(cgi|asp|cfg|ini|bak|backup|old|env|php|php5|php7|phtml) {
    return 444;
}

# Common bot paths and exploit-prone directories
location ~* /(wp-admin|wp-login|wp-content|xmlrpc\.php|phpmyadmin|pma|hudson|jenkins|shell|console|vendor|phpunit|cgi-bin|containers/json|\.env|\.git) {
    return 444;
}

# Block requests with empty or missing Host header (botnet signature)
if ($host = "") {
    return 444;
}

# Block requests directly to IP instead of domain
if ($host ~* "^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$") {
    return 444;
}
